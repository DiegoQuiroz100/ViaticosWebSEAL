@{
    ViewBag.Title = "Vale de Combustible";
}

<h2>Vale de Combustible</h2>

<!-- Dropdown para seleccionar área -->
<div>
    <label for="areaSelect">Área:</label>
    <select id="areaSelect" class="form-control">
        <option value="">Seleccione un área</option>
        @foreach (var area in ViewBag.Areas)
        {
            <option value="@area.Id">@area.Nombre</option>
        }
    </select>
</div>

<!-- Dropdown para seleccionar placa de rodaje -->
<div>
    <label for="placaSelect">Placa de Rodaje:</label>
    <select id="placaSelect" class="form-control" disabled>
        <option value="">Seleccione una placa</option>
    </select>
</div>

<!-- Detalles del vehículo -->
<div>
    <label for="marca">Marca:</label>
    <input type="text" id="marca" class="form-control" readonly />

    <label for="anio">Año:</label>
    <input type="text" id="anio" class="form-control" readonly />

    <label for="tipo">Tipo:</label>
    <input type="text" id="tipo" class="form-control" readonly />

    <label for="areaAsignada">Área Asignada:</label>
    <input type="text" id="areaAsignada" class="form-control" readonly />

    <label for="asignado">Asignado:</label>
    <input type="text" id="asignado" class="form-control" readonly />

    <label for="estado">Estado:</label>
    <input type="text" id="estado" class="form-control" readonly />

    <label for="combustible">Combustible:</label>
    <input type="text" id="combustible" class="form-control" readonly />
</div>

<!-- Información sobre el vale -->
<div>
    <label for="kilometraje">Kilometraje:</label>
    <input type="number" id="kilometraje" class="form-control" />

    <label for="cantidad">Cantidad de Galones:</label>
    <input type="number" id="cantidad" class="form-control" />
</div>

<!-- Dropdown para seleccionar grifo -->
<div>
    <label for="grifos">Grifo:</label>
    <select id="grifos" class="form-control">
        <option value="">Seleccione un grifo</option>
        @foreach (var grifo in ViewBag.Grifos)
        {
            <option value="@grifo.Id">@grifo.Descripcion</option>
        }
    </select>
</div>

<button id="guardarVale" class="btn btn-primary">Guardar Vale</button>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        // Cargar placas cuando se selecciona un área
        $('#areaSelect').change(function () {
            var unidadId = $(this).val();
            if (unidadId) {
                $.getJSON('/ValeCombustible/GetPlacas', { unidadId: unidadId }, function (data) {
                    var placaSelect = $('#placaSelect');
                    placaSelect.empty().append('<option value="">Seleccione una placa</option>');
                    $.each(data, function (i, item) {
                        placaSelect.append('<option value="' + item.Id + '">' + item.Placa + '</option>');
                    });
                    placaSelect.prop('disabled', false);
                });
            } else {
                $('#placaSelect').prop('disabled', true).empty().append('<option value="">Seleccione una placa</option>');
            }
        });

        // Cargar detalles del vehículo cuando se selecciona una placa
        $('#placaSelect').change(function () {
            var placaId = $(this).val();
            if (placaId) {
                $.getJSON('/ValeCombustible/GetVehiculoDetails', { placaId: placaId }, function (data) {
                    $('#marca').val(data.Marca);
                    $('#anio').val(data.Anio);
                    $('#tipo').val(data.Tipo);
                    $('#areaAsignada').val(data.AreaAsignada);
                    $('#asignado').val(data.Asignado);
                    $('#estado').val(data.Estado);
                    $('#combustible').val(data.Combustible);
                });
            }
        });

        // Guardar vale
        $('#guardarVale').click(function () {
            var vale = {
                PlacaId: $('#placaSelect').val(),
                Kilometraje: $('#kilometraje').val(),
                Cantidad: $('#cantidad').val(),
                GrifoId: $('#grifos').val()
            };

            $.post('/ValeCombustible/GuardarVale', vale, function (response) {
                alert(response.message);
                if (response.success) {
                    location.reload();  // Recargar la página si la operación fue exitosa
                }
            });
        });
    });
</script>
